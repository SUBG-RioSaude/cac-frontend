# Guia de Integra√ß√£o Frontend - API de Notifica√ß√µes

## Vis√£o Geral

Este guia mostra como integrar o frontend (React, Vue, Angular, etc.) com o microservi√ßo de notifica√ß√µes usando:

- **SignalR** para notifica√ß√µes em tempo real
- **REST API** para opera√ß√µes CRUD e prefer√™ncias
- **JWT** para autentica√ß√£o de usu√°rios

## √çndice

1. [Instala√ß√£o](#instala√ß√£o)
2. [Autentica√ß√£o](#autentica√ß√£o)
3. [SignalR - Notifica√ß√µes em Tempo Real](#signalr---notifica√ß√µes-em-tempo-real)
4. [REST API - Opera√ß√µes CRUD](#rest-api---opera√ß√µes-crud)
5. [Gerenciamento de Prefer√™ncias](#gerenciamento-de-prefer√™ncias)
6. [Exemplos Completos](#exemplos-completos)
7. [Tratamento de Erros](#tratamento-de-erros)
8. [Boas Pr√°ticas](#boas-pr√°ticas)

---

## Instala√ß√£o

### React/JavaScript

```bash
npm install @microsoft/signalr axios
```

### TypeScript (recomendado)

```bash
npm install @microsoft/signalr axios
npm install -D @types/microsoft__signalr
```

---

## Autentica√ß√£o

### Obtendo o Token JWT

O token JWT deve ser obtido atrav√©s do microservi√ßo de autentica√ß√£o (`egestao-micro-auth-api`). N√£o √© responsabilidade da API de notifica√ß√µes gerar tokens.

```typescript
// Exemplo de autentica√ß√£o (via microservi√ßo de auth)
async function login(username: string, password: string) {
  const response = await axios.post('https://auth.egestao.com/api/auth/login', {
    username,
    password
  });

  const { token, usuario } = response.data;

  // Salvar token (localStorage, sessionStorage, cookie seguro, etc.)
  localStorage.setItem('jwt_token', token);
  localStorage.setItem('usuario_id', usuario.id);

  return token;
}
```

### Estrutura do Token JWT

O token deve conter os seguintes claims:

```json
{
  "sub": "usuario-id-guid",
  "email": "usuario@example.com",
  "nome": "Nome do Usu√°rio",
  "iss": "egestao-micro-auth-api",
  "aud": "egestao-frontend",
  "exp": 1735689600
}
```

---

## SignalR - Notifica√ß√µes em Tempo Real

### 1. Criar Conex√£o SignalR

```typescript
import * as signalR from '@microsoft/signalr';

class NotificacaoService {
  private connection: signalR.HubConnection | null = null;
  private listeners: Map<string, Function[]> = new Map();

  constructor(private baseUrl: string) {}

  /**
   * Conecta ao SignalR Hub
   */
  async conectar(jwtToken: string): Promise<void> {
    if (this.connection?.state === signalR.HubConnectionState.Connected) {
      console.log('J√° conectado ao SignalR');
      return;
    }

    this.connection = new signalR.HubConnectionBuilder()
      .withUrl(`${this.baseUrl}/api/notificacaohub`, {
        accessTokenFactory: () => jwtToken,
        skipNegotiation: true,
        transport: signalR.HttpTransportType.WebSockets
      })
      .withAutomaticReconnect({
        nextRetryDelayInMilliseconds: (retryContext) => {
          // Backoff exponencial: 0s, 2s, 10s, 30s, ent√£o sempre 30s
          if (retryContext.previousRetryCount === 0) return 0;
          if (retryContext.previousRetryCount === 1) return 2000;
          if (retryContext.previousRetryCount === 2) return 10000;
          return 30000;
        }
      })
      .configureLogging(signalR.LogLevel.Information)
      .build();

    // Registrar listeners para eventos
    this.setupEventListeners();

    try {
      await this.connection.start();
      console.log('‚úÖ Conectado ao SignalR Hub');
    } catch (error) {
      console.error('‚ùå Erro ao conectar ao SignalR:', error);
      throw error;
    }
  }

  /**
   * Desconecta do SignalR Hub
   */
  async desconectar(): Promise<void> {
    if (this.connection) {
      await this.connection.stop();
      console.log('Desconectado do SignalR Hub');
    }
  }

  /**
   * Configura os event listeners
   */
  private setupEventListeners(): void {
    if (!this.connection) return;

    // Evento: Nova notifica√ß√£o recebida
    this.connection.on('ReceberNotificacao', (notificacao: Notificacao) => {
      console.log('üì¨ Nova notifica√ß√£o recebida:', notificacao);
      this.trigger('nova-notificacao', notificacao);
    });

    // Evento: Notifica√ß√£o marcada como lida
    this.connection.on('NotificacaoLida', (notificacaoId: string) => {
      console.log('‚úÖ Notifica√ß√£o marcada como lida:', notificacaoId);
      this.trigger('notificacao-lida', notificacaoId);
    });

    // Evento: Reconex√£o bem-sucedida
    this.connection.onreconnected((connectionId) => {
      console.log('üîÑ Reconectado ao SignalR. ConnectionId:', connectionId);
      this.trigger('reconectado', connectionId);
    });

    // Evento: Tentando reconectar
    this.connection.onreconnecting((error) => {
      console.log('üîÑ Tentando reconectar...', error);
      this.trigger('reconectando', error);
    });

    // Evento: Conex√£o fechada
    this.connection.onclose((error) => {
      console.log('‚ùå Conex√£o fechada', error);
      this.trigger('desconectado', error);
    });
  }

  /**
   * Adiciona um listener para um evento
   */
  on(evento: string, callback: Function): void {
    if (!this.listeners.has(evento)) {
      this.listeners.set(evento, []);
    }
    this.listeners.get(evento)!.push(callback);
  }

  /**
   * Remove um listener
   */
  off(evento: string, callback: Function): void {
    const callbacks = this.listeners.get(evento);
    if (callbacks) {
      const index = callbacks.indexOf(callback);
      if (index > -1) {
        callbacks.splice(index, 1);
      }
    }
  }

  /**
   * Dispara um evento
   */
  private trigger(evento: string, ...args: any[]): void {
    const callbacks = this.listeners.get(evento);
    if (callbacks) {
      callbacks.forEach(callback => callback(...args));
    }
  }

  /**
   * Verifica se est√° conectado
   */
  get estaConectado(): boolean {
    return this.connection?.state === signalR.HubConnectionState.Connected;
  }
}

// Tipos TypeScript
interface Notificacao {
  id: string;
  sistemaId: string;
  usuarioId: string;
  titulo: string;
  mensagem: string;
  tipo: 'info' | 'success' | 'warning' | 'error';
  lida: boolean;
  lidaEm?: string;
  arquivada: boolean;
  arquivadaEm?: string;
  criadoEm: string;
  metadados?: Record<string, any>;
}
```

### 2. Uso em React Hook

```typescript
import { useEffect, useRef, useState } from 'react';

export function useNotificacoes() {
  const [notificacoes, setNotificacoes] = useState<Notificacao[]>([]);
  const [conectado, setConectado] = useState(false);
  const serviceRef = useRef<NotificacaoService | null>(null);

  useEffect(() => {
    const token = localStorage.getItem('jwt_token');
    if (!token) {
      console.warn('Token JWT n√£o encontrado');
      return;
    }

    // Criar servi√ßo
    const service = new NotificacaoService('https://notificacoes.egestao.com');
    serviceRef.current = service;

    // Registrar listeners
    service.on('nova-notificacao', (notificacao: Notificacao) => {
      setNotificacoes(prev => [notificacao, ...prev]);

      // Mostrar notifica√ß√£o do navegador
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(notificacao.titulo, {
          body: notificacao.mensagem,
          icon: '/logo.png',
          tag: notificacao.id
        });
      }
    });

    service.on('notificacao-lida', (notificacaoId: string) => {
      setNotificacoes(prev =>
        prev.map(n => n.id === notificacaoId ? { ...n, lida: true } : n)
      );
    });

    service.on('reconectado', () => {
      setConectado(true);
      // Recarregar notifica√ß√µes ap√≥s reconex√£o
      carregarNotificacoes();
    });

    service.on('reconectando', () => setConectado(false));
    service.on('desconectado', () => setConectado(false));

    // Conectar
    service.conectar(token)
      .then(() => {
        setConectado(true);
        carregarNotificacoes();
      })
      .catch(err => console.error('Erro ao conectar:', err));

    // Cleanup
    return () => {
      service.desconectar();
    };
  }, []);

  const carregarNotificacoes = async () => {
    try {
      const token = localStorage.getItem('jwt_token');
      const response = await axios.get('https://notificacoes.egestao.com/api/notificacoes', {
        headers: { Authorization: `Bearer ${token}` }
      });
      setNotificacoes(response.data);
    } catch (error) {
      console.error('Erro ao carregar notifica√ß√µes:', error);
    }
  };

  return { notificacoes, conectado, service: serviceRef.current };
}
```

---

## REST API - Opera√ß√µes CRUD

### Configura√ß√£o do Axios

```typescript
import axios from 'axios';

const api = axios.create({
  baseURL: 'https://notificacoes.egestao.com/api',
  timeout: 10000
});

// Interceptor para adicionar token automaticamente
api.interceptors.request.use(config => {
  const token = localStorage.getItem('jwt_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Interceptor para tratar erros
api.interceptors.response.use(
  response => response,
  error => {
    if (error.response?.status === 401) {
      // Token expirado - redirecionar para login
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

### Endpoints Dispon√≠veis

#### 1. Listar Notifica√ß√µes do Usu√°rio

```typescript
/**
 * Lista todas as notifica√ß√µes do usu√°rio autenticado
 */
async function listarNotificacoes(): Promise<Notificacao[]> {
  const response = await api.get<Notificacao[]>('/notificacoes');
  return response.data;
}

// Com filtros
async function listarNotificacoesComFiltros(params: {
  lida?: boolean;
  arquivada?: boolean;
  tipo?: string;
  limit?: number;
}): Promise<Notificacao[]> {
  const response = await api.get<Notificacao[]>('/notificacoes', { params });
  return response.data;
}

// Exemplo de uso:
const naoLidas = await listarNotificacoesComFiltros({ lida: false });
const avisos = await listarNotificacoesComFiltros({ tipo: 'warning' });
```

#### 2. Obter Notifica√ß√£o por ID

```typescript
async function obterNotificacao(id: string): Promise<Notificacao> {
  const response = await api.get<Notificacao>(`/notificacoes/${id}`);
  return response.data;
}
```

#### 3. Marcar como Lida

```typescript
async function marcarComoLida(id: string): Promise<void> {
  await api.patch(`/notificacoes/${id}/marcar-lida`);
}
```

#### 4. Marcar como N√£o Lida

```typescript
async function marcarComoNaoLida(id: string): Promise<void> {
  await api.patch(`/notificacoes/${id}/marcar-nao-lida`);
}
```

#### 5. Arquivar Notifica√ß√£o

```typescript
async function arquivar(id: string): Promise<void> {
  await api.patch(`/notificacoes/${id}/arquivar`);
}
```

#### 6. Desarquivar Notifica√ß√£o

```typescript
async function desarquivar(id: string): Promise<void> {
  await api.patch(`/notificacoes/${id}/desarquivar`);
}
```

#### 7. Marcar Todas como Lidas

```typescript
async function marcarTodasComoLidas(): Promise<void> {
  await api.post('/notificacoes/marcar-todas-lidas');
}
```

#### 8. Deletar Notifica√ß√£o

```typescript
async function deletarNotificacao(id: string): Promise<void> {
  await api.delete(`/notificacoes/${id}`);
}
```

---

## Gerenciamento de Prefer√™ncias

### 1. Obter Prefer√™ncias

```typescript
interface Preferencia {
  id: string;
  usuarioId: string;
  receberNotificacoes: boolean;
  receberPorEmail: boolean;
  receberPorSms: boolean;
  notificarInfo: boolean;
  notificarSuccess: boolean;
  notificarWarning: boolean;
  notificarError: boolean;
  horarioInicioSilencioso?: string;  // "22:00:00"
  horarioFimSilencioso?: string;     // "07:00:00"
}

async function obterPreferencias(): Promise<Preferencia> {
  const response = await api.get<Preferencia>('/preferencias');
  return response.data;
}
```

### 2. Atualizar Prefer√™ncias

```typescript
async function atualizarPreferencias(preferencias: Partial<Preferencia>): Promise<Preferencia> {
  const response = await api.put<Preferencia>('/preferencias', preferencias);
  return response.data;
}

// Exemplo de uso:
await atualizarPreferencias({
  receberNotificacoes: true,
  notificarError: true,
  notificarWarning: true,
  horarioInicioSilencioso: '22:00:00',
  horarioFimSilencioso: '07:00:00'
});
```

---

## Exemplos Completos

### Componente React - Listagem de Notifica√ß√µes

```tsx
import React, { useState } from 'react';
import { useNotificacoes } from './hooks/useNotificacoes';
import api from './services/api';

export function NotificacoesPanel() {
  const { notificacoes, conectado } = useNotificacoes();
  const [filtro, setFiltro] = useState<'todas' | 'nao-lidas' | 'arquivadas'>('todas');

  const notificacoesFiltradas = React.useMemo(() => {
    switch (filtro) {
      case 'nao-lidas':
        return notificacoes.filter(n => !n.lida && !n.arquivada);
      case 'arquivadas':
        return notificacoes.filter(n => n.arquivada);
      default:
        return notificacoes.filter(n => !n.arquivada);
    }
  }, [notificacoes, filtro]);

  const handleMarcarLida = async (id: string) => {
    try {
      await api.patch(`/notificacoes/${id}/marcar-lida`);
    } catch (error) {
      console.error('Erro ao marcar como lida:', error);
    }
  };

  const handleArquivar = async (id: string) => {
    try {
      await api.patch(`/notificacoes/${id}/arquivar`);
    } catch (error) {
      console.error('Erro ao arquivar:', error);
    }
  };

  const handleMarcarTodasLidas = async () => {
    try {
      await api.post('/notificacoes/marcar-todas-lidas');
    } catch (error) {
      console.error('Erro ao marcar todas como lidas:', error);
    }
  };

  return (
    <div className="notificacoes-panel">
      <div className="header">
        <h2>Notifica√ß√µes</h2>
        <span className={`status ${conectado ? 'online' : 'offline'}`}>
          {conectado ? 'üü¢ Online' : 'üî¥ Offline'}
        </span>
      </div>

      <div className="filtros">
        <button onClick={() => setFiltro('todas')} className={filtro === 'todas' ? 'active' : ''}>
          Todas
        </button>
        <button onClick={() => setFiltro('nao-lidas')} className={filtro === 'nao-lidas' ? 'active' : ''}>
          N√£o Lidas ({notificacoes.filter(n => !n.lida && !n.arquivada).length})
        </button>
        <button onClick={() => setFiltro('arquivadas')} className={filtro === 'arquivadas' ? 'active' : ''}>
          Arquivadas
        </button>
        <button onClick={handleMarcarTodasLidas} className="action-btn">
          Marcar Todas como Lidas
        </button>
      </div>

      <div className="notificacoes-lista">
        {notificacoesFiltradas.length === 0 ? (
          <p className="vazio">Nenhuma notifica√ß√£o</p>
        ) : (
          notificacoesFiltradas.map(notif => (
            <div
              key={notif.id}
              className={`notificacao ${notif.tipo} ${notif.lida ? 'lida' : 'nao-lida'}`}
            >
              <div className="icone">{getIcone(notif.tipo)}</div>
              <div className="conteudo">
                <h4>{notif.titulo}</h4>
                <p>{notif.mensagem}</p>
                <small>{new Date(notif.criadoEm).toLocaleString('pt-BR')}</small>
              </div>
              <div className="acoes">
                {!notif.lida && (
                  <button onClick={() => handleMarcarLida(notif.id)} title="Marcar como lida">
                    ‚úì
                  </button>
                )}
                {!notif.arquivada ? (
                  <button onClick={() => handleArquivar(notif.id)} title="Arquivar">
                    üì•
                  </button>
                ) : (
                  <button onClick={() => api.patch(`/notificacoes/${notif.id}/desarquivar`)} title="Desarquivar">
                    üì§
                  </button>
                )}
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
}

function getIcone(tipo: string): string {
  switch (tipo) {
    case 'info': return '‚ÑπÔ∏è';
    case 'success': return '‚úÖ';
    case 'warning': return '‚ö†Ô∏è';
    case 'error': return '‚ùå';
    default: return 'üì¨';
  }
}
```

### Componente React - Prefer√™ncias

```tsx
import React, { useEffect, useState } from 'react';
import api from './services/api';

export function PreferenciasNotificacoes() {
  const [preferencias, setPreferencias] = useState<Preferencia | null>(null);
  const [salvando, setSalvando] = useState(false);

  useEffect(() => {
    carregarPreferencias();
  }, []);

  const carregarPreferencias = async () => {
    try {
      const response = await api.get<Preferencia>('/preferencias');
      setPreferencias(response.data);
    } catch (error) {
      console.error('Erro ao carregar prefer√™ncias:', error);
    }
  };

  const handleSalvar = async () => {
    if (!preferencias) return;

    setSalvando(true);
    try {
      await api.put('/preferencias', preferencias);
      alert('Prefer√™ncias salvas com sucesso!');
    } catch (error) {
      console.error('Erro ao salvar prefer√™ncias:', error);
      alert('Erro ao salvar prefer√™ncias');
    } finally {
      setSalvando(false);
    }
  };

  if (!preferencias) return <div>Carregando...</div>;

  return (
    <div className="preferencias-notificacoes">
      <h2>Prefer√™ncias de Notifica√ß√µes</h2>

      <div className="secao">
        <h3>Canais de Notifica√ß√£o</h3>
        <label>
          <input
            type="checkbox"
            checked={preferencias.receberNotificacoes}
            onChange={e => setPreferencias({ ...preferencias, receberNotificacoes: e.target.checked })}
          />
          Receber notifica√ß√µes no sistema
        </label>
        <label>
          <input
            type="checkbox"
            checked={preferencias.receberPorEmail}
            onChange={e => setPreferencias({ ...preferencias, receberPorEmail: e.target.checked })}
          />
          Receber por e-mail
        </label>
        <label>
          <input
            type="checkbox"
            checked={preferencias.receberPorSms}
            onChange={e => setPreferencias({ ...preferencias, receberPorSms: e.target.checked })}
          />
          Receber por SMS
        </label>
      </div>

      <div className="secao">
        <h3>Tipos de Notifica√ß√£o</h3>
        <label>
          <input
            type="checkbox"
            checked={preferencias.notificarInfo}
            onChange={e => setPreferencias({ ...preferencias, notificarInfo: e.target.checked })}
          />
          ‚ÑπÔ∏è Informa√ß√µes
        </label>
        <label>
          <input
            type="checkbox"
            checked={preferencias.notificarSuccess}
            onChange={e => setPreferencias({ ...preferencias, notificarSuccess: e.target.checked })}
          />
          ‚úÖ Sucesso
        </label>
        <label>
          <input
            type="checkbox"
            checked={preferencias.notificarWarning}
            onChange={e => setPreferencias({ ...preferencias, notificarWarning: e.target.checked })}
          />
          ‚ö†Ô∏è Avisos
        </label>
        <label>
          <input
            type="checkbox"
            checked={preferencias.notificarError}
            onChange={e => setPreferencias({ ...preferencias, notificarError: e.target.checked })}
          />
          ‚ùå Erros
        </label>
      </div>

      <div className="secao">
        <h3>Hor√°rio Silencioso</h3>
        <label>
          In√≠cio:
          <input
            type="time"
            value={preferencias.horarioInicioSilencioso || ''}
            onChange={e => setPreferencias({ ...preferencias, horarioInicioSilencioso: e.target.value })}
          />
        </label>
        <label>
          Fim:
          <input
            type="time"
            value={preferencias.horarioFimSilencioso || ''}
            onChange={e => setPreferencias({ ...preferencias, horarioFimSilencioso: e.target.value })}
          />
        </label>
      </div>

      <button onClick={handleSalvar} disabled={salvando}>
        {salvando ? 'Salvando...' : 'Salvar Prefer√™ncias'}
      </button>
    </div>
  );
}
```

### Componente - Bell Icon com Badge

```tsx
import React from 'react';
import { useNotificacoes } from './hooks/useNotificacoes';

export function NotificationBell() {
  const { notificacoes } = useNotificacoes();
  const [mostrarPanel, setMostrarPanel] = useState(false);

  const naoLidas = notificacoes.filter(n => !n.lida && !n.arquivada).length;

  return (
    <div className="notification-bell">
      <button onClick={() => setMostrarPanel(!mostrarPanel)}>
        üîî
        {naoLidas > 0 && <span className="badge">{naoLidas}</span>}
      </button>

      {mostrarPanel && (
        <div className="notification-dropdown">
          <NotificacoesPanel />
        </div>
      )}
    </div>
  );
}
```

---

## Tratamento de Erros

### Erros Comuns e Solu√ß√µes

| C√≥digo | Erro | Causa | Solu√ß√£o |
|--------|------|-------|---------|
| 401 | Unauthorized | Token JWT ausente ou inv√°lido | Redirecionar para login |
| 403 | Forbidden | Token v√°lido mas sem permiss√£o | Mostrar mensagem de acesso negado |
| 404 | Not Found | Notifica√ß√£o n√£o encontrada | Atualizar lista de notifica√ß√µes |
| 409 | Conflict | Opera√ß√£o conflitante | Atualizar dados e tentar novamente |
| 500 | Internal Server Error | Erro no servidor | Mostrar mensagem gen√©rica e logar erro |

### Exemplo de Tratamento

```typescript
async function marcarComoLida(id: string): Promise<void> {
  try {
    await api.patch(`/notificacoes/${id}/marcar-lida`);
  } catch (error) {
    if (axios.isAxiosError(error)) {
      switch (error.response?.status) {
        case 401:
          window.location.href = '/login';
          break;
        case 404:
          alert('Notifica√ß√£o n√£o encontrada');
          // Recarregar lista
          break;
        case 500:
          console.error('Erro no servidor:', error);
          alert('Erro ao processar solicita√ß√£o. Tente novamente.');
          break;
        default:
          alert('Erro desconhecido');
      }
    }
    throw error;
  }
}
```

---

## Boas Pr√°ticas

### 1. Gerenciamento de Estado

Use bibliotecas como Redux, Zustand ou Context API para gerenciar notifica√ß√µes globalmente:

```typescript
// Exemplo com Zustand
import create from 'zustand';

interface NotificacoesStore {
  notificacoes: Notificacao[];
  adicionarNotificacao: (notificacao: Notificacao) => void;
  marcarComoLida: (id: string) => void;
  removerNotificacao: (id: string) => void;
}

export const useNotificacoesStore = create<NotificacoesStore>((set) => ({
  notificacoes: [],
  adicionarNotificacao: (notificacao) =>
    set((state) => ({ notificacoes: [notificacao, ...state.notificacoes] })),
  marcarComoLida: (id) =>
    set((state) => ({
      notificacoes: state.notificacoes.map((n) =>
        n.id === id ? { ...n, lida: true } : n
      ),
    })),
  removerNotificacao: (id) =>
    set((state) => ({
      notificacoes: state.notificacoes.filter((n) => n.id !== id),
    })),
}));
```

### 2. Permiss√µes de Notifica√ß√£o do Navegador

```typescript
async function solicitarPermissaoNotificacao(): Promise<boolean> {
  if (!('Notification' in window)) {
    console.log('Este navegador n√£o suporta notifica√ß√µes');
    return false;
  }

  if (Notification.permission === 'granted') {
    return true;
  }

  if (Notification.permission !== 'denied') {
    const permission = await Notification.requestPermission();
    return permission === 'granted';
  }

  return false;
}

// Solicitar ao fazer login
useEffect(() => {
  solicitarPermissaoNotificacao();
}, []);
```

### 3. Persist√™ncia Local (Offline-first)

```typescript
// Sincronizar notifica√ß√µes com IndexedDB para acesso offline
import { openDB } from 'idb';

const db = await openDB('notificacoes-db', 1, {
  upgrade(db) {
    db.createObjectStore('notificacoes', { keyPath: 'id' });
  },
});

async function salvarNotificacoesLocal(notificacoes: Notificacao[]) {
  const tx = db.transaction('notificacoes', 'readwrite');
  await Promise.all(notificacoes.map(n => tx.store.put(n)));
}

async function carregarNotificacoesLocal(): Promise<Notificacao[]> {
  return await db.getAll('notificacoes');
}
```

### 4. Debounce em Opera√ß√µes

```typescript
import { debounce } from 'lodash';

// Evitar m√∫ltiplas chamadas simult√¢neas
const marcarComoLidaDebounced = debounce(async (id: string) => {
  await api.patch(`/notificacoes/${id}/marcar-lida`);
}, 300);
```

### 5. Logs Estruturados

```typescript
class Logger {
  static info(mensagem: string, dados?: any) {
    console.log(`[INFO] ${mensagem}`, dados);
    // Enviar para servi√ßo de logging (Sentry, LogRocket, etc.)
  }

  static error(mensagem: string, erro: Error, dados?: any) {
    console.error(`[ERROR] ${mensagem}`, erro, dados);
    // Enviar para Sentry, etc.
  }
}

// Uso:
Logger.info('Nova notifica√ß√£o recebida', { notificacaoId: notificacao.id });
Logger.error('Erro ao marcar como lida', error, { notificacaoId: id });
```

---

## Resumo dos Endpoints

| M√©todo | Endpoint | Autentica√ß√£o | Descri√ß√£o |
|--------|----------|--------------|-----------|
| GET | /api/notificacoes | JWT | Lista notifica√ß√µes do usu√°rio |
| GET | /api/notificacoes/{id} | JWT | Obter notifica√ß√£o espec√≠fica |
| PATCH | /api/notificacoes/{id}/marcar-lida | JWT | Marcar como lida |
| PATCH | /api/notificacoes/{id}/marcar-nao-lida | JWT | Marcar como n√£o lida |
| PATCH | /api/notificacoes/{id}/arquivar | JWT | Arquivar notifica√ß√£o |
| PATCH | /api/notificacoes/{id}/desarquivar | JWT | Desarquivar notifica√ß√£o |
| POST | /api/notificacoes/marcar-todas-lidas | JWT | Marcar todas como lidas |
| DELETE | /api/notificacoes/{id} | JWT | Deletar notifica√ß√£o |
| GET | /api/preferencias | JWT | Obter prefer√™ncias |
| PUT | /api/preferencias | JWT | Atualizar prefer√™ncias |
| WS | /api/notificacaohub | JWT (query) | SignalR Hub |

---

## Suporte

Para d√∫vidas ou problemas:
- Consulte o Swagger em `https://notificacoes.egestao.com/swagger`
- Verifique os logs do console do navegador
- Entre em contato com a equipe de desenvolvimento

---

## Changelog

- **v1.0** - Vers√£o inicial com SignalR e REST API
- Arquivamento de notifica√ß√µes
- Prefer√™ncias de notifica√ß√£o
- Autentica√ß√£o JWT
- API Keys para microservi√ßos
