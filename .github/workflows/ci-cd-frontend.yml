# ğŸ¨ CI/CD - Frontend CAC
# Testes, Lint, Build e Push versionado para Docker Hub

name: ğŸ¨ CI/CD - Frontend CAC

on:
  push:
    branches: [ develop, staging, master ]
  pull_request:
    branches: [ develop, staging, master ]

env:
  REGISTRY: docker.io
  IMAGE_NAME: cac-frontend

jobs:
  # ğŸ§ª QUALIDADE DE CÃ“DIGO E TESTES
  quality-check:
    name: ğŸ§ª Testes de qualidade & Testes (Node ${{ matrix.node-version }})
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [20, 22]
      fail-fast: false

    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: ğŸ“¦ Install pnpm
      uses: pnpm/action-setup@v4
      with:
        run_install: false

    - name: ğŸ”§ Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'pnpm'

    - name: ğŸ“¦ Install Dependencies
      run: pnpm install --frozen-lockfile

    - name: ğŸ” Code Quality Check
      run: |
        echo "ğŸ” Running ESLint..."
        pnpm lint
        echo "âœ… ESLint passed!"

    - name: ğŸ¨ Format Check
      continue-on-error: true
      run: |
        echo "ğŸ¨ Checking code formatting..."
        if pnpm format:check; then
          echo "âœ… Code formatting is correct!"
        else
          echo "âš ï¸ Code formatting issues found - consider running 'pnpm format'"
          echo "::warning::Code formatting issues detected. Run 'pnpm format' to fix automatically."
        fi

    # ğŸ’¡ DESCOMENTE PARA TORNAR FORMATAÃ‡ÃƒO OBRIGATÃ“RIA:
    # - name: ğŸ¨ Format Check (Strict)
    #   run: |
    #     echo "ğŸ¨ Checking code formatting (strict mode)..."
    #     pnpm format:check
    #     echo "âœ… Code formatting is correct!"

    - name: ğŸ—ï¸ TypeScript Build Check
      run: |
        echo "ğŸ—ï¸ Checking TypeScript compilation..."

        # Medir tempo de build
        BUILD_START=$(date +%s)
        pnpm build
        BUILD_END=$(date +%s)
        BUILD_TIME=$((BUILD_END - BUILD_START))

        echo "BUILD_TIME=$BUILD_TIME" >> $GITHUB_ENV
        echo "âœ… TypeScript build successful in ${BUILD_TIME}s!"

        # Performance budget check
        if [ $BUILD_TIME -gt 120 ]; then
          echo "::warning::Build time (${BUILD_TIME}s) exceeds 2 minutes"
        fi

    - name: ğŸ“¦ Bundle Size Analysis
      run: |
        echo "ğŸ“¦ Analyzing bundle size..."

        if [ -d "dist" ]; then
          # Calcular tamanho do bundle
          BUNDLE_SIZE_HUMAN=$(du -sh dist/ | cut -f1)
          BUNDLE_SIZE_BYTES=$(du -sb dist/ | cut -f1)

          echo "## ğŸ“¦ Bundle Size Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Metric | Size | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Total Bundle | $BUNDLE_SIZE_HUMAN | $([ $BUNDLE_SIZE_BYTES -le 5242880 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Threshold:** â‰¤ 5MB (5,242,880 bytes)" >> $GITHUB_STEP_SUMMARY

          # Assets breakdown
          if [ -d "dist/assets" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ğŸ“ Assets Breakdown" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            ls -lah dist/assets/ | head -10 >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          fi

          # Warning for large bundles
          if [ $BUNDLE_SIZE_BYTES -gt 5242880 ]; then
            echo "âš ï¸ Bundle size ($BUNDLE_SIZE_HUMAN) exceeds 5MB threshold"
            echo "::warning::Bundle size is large. Consider code splitting or optimizations."
          else
            echo "âœ… Bundle size within acceptable limits"
          fi
        else
          echo "âš ï¸ Build directory not found"
          echo "::warning::Could not analyze bundle size - dist directory missing"
        fi

    - name: ğŸ§ª Run Tests with Coverage
      run: |
        echo "ğŸ§ª Running Vitest tests with coverage..."

        # Medir tempo de testes
        TEST_START=$(date +%s)
        pnpm test --run --reporter=verbose --coverage
        TEST_END=$(date +%s)
        TEST_TIME=$((TEST_END - TEST_START))

        echo "TEST_TIME=$TEST_TIME" >> $GITHUB_ENV
        echo "âœ… All tests passed in ${TEST_TIME}s!"

        # Performance budget check
        if [ $TEST_TIME -gt 300 ]; then
          echo "::warning::Test time (${TEST_TIME}s) exceeds 5 minutes"
        fi

    - name: ğŸ“Š Coverage Report
      run: |
        echo "## ğŸ“Š Test Coverage Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        if [ -f coverage/coverage-summary.json ]; then
          LINES=$(jq -r '.total.lines.pct' coverage/coverage-summary.json)
          FUNCTIONS=$(jq -r '.total.functions.pct' coverage/coverage-summary.json)
          BRANCHES=$(jq -r '.total.branches.pct' coverage/coverage-summary.json)
          STATEMENTS=$(jq -r '.total.statements.pct' coverage/coverage-summary.json)

          echo "| Metric | Coverage | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Lines | ${LINES}% | $([ ${LINES%.*} -ge 85 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
          echo "| Functions | ${FUNCTIONS}% | $([ ${FUNCTIONS%.*} -ge 90 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
          echo "| Branches | ${BRANCHES}% | $([ ${BRANCHES%.*} -ge 85 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
          echo "| Statements | ${STATEMENTS}% | $([ ${STATEMENTS%.*} -ge 90 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Thresholds:** Lines â‰¥85%, Functions â‰¥90%, Branches â‰¥85%, Statements â‰¥90%" >> $GITHUB_STEP_SUMMARY
        else
          echo "âš ï¸ Coverage report not found" >> $GITHUB_STEP_SUMMARY
        fi

    - name: ğŸ¯ Coverage Enforcement
      run: |
        if [ -f coverage/coverage-summary.json ]; then
          LINES=$(jq -r '.total.lines.pct' coverage/coverage-summary.json)
          FUNCTIONS=$(jq -r '.total.functions.pct' coverage/coverage-summary.json)

          echo "ğŸ¯ Checking coverage thresholds..."

          if (( $(echo "$LINES < 85" | bc -l) )); then
            echo "âŒ Lines coverage ($LINES%) is below threshold (85%)"
            exit 1
          fi

          if (( $(echo "$FUNCTIONS < 90" | bc -l) )); then
            echo "âŒ Functions coverage ($FUNCTIONS%) is below threshold (90%)"
            exit 1
          fi

          echo "âœ… All coverage thresholds met!"
        else
          echo "âš ï¸ Coverage file not found - skipping enforcement"
        fi

    - name: âš¡ Performance Report
      run: |
        echo "## âš¡ Performance Metrics" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Metric | Time | Budget | Status |" >> $GITHUB_STEP_SUMMARY
        echo "|--------|------|--------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| Build | ${BUILD_TIME}s | â‰¤ 120s | $([ $BUILD_TIME -le 120 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
        echo "| Tests | ${TEST_TIME}s | â‰¤ 300s | $([ $TEST_TIME -le 300 ] && echo 'âœ…' || echo 'âš ï¸') |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        TOTAL_TIME=$((BUILD_TIME + TEST_TIME))
        echo "**Total CI Time:** ${TOTAL_TIME}s" >> $GITHUB_STEP_SUMMARY

  # ğŸ“Š ANÃLISE DE PR - Bundle Size Comparison
  pr-analysis:
    name: ğŸ“Š PR Analysis
    runs-on: ubuntu-latest
    needs: quality-check
    if: github.event_name == 'pull_request'

    steps:
    - name: ğŸ“¥ Checkout PR Branch
      uses: actions/checkout@v4

    - name: ğŸ“¦ Install pnpm
      uses: pnpm/action-setup@v4
      with:
        run_install: false

    - name: ğŸ”§ Setup Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'pnpm'

    - name: ğŸ“¦ Install Dependencies
      run: pnpm install --frozen-lockfile

    - name: ğŸ—ï¸ Build PR Branch
      run: |
        echo "ğŸ—ï¸ Building PR branch..."
        pnpm build
        PR_SIZE=$(du -sb dist/ | cut -f1)
        echo "PR_BUNDLE_SIZE=$PR_SIZE" >> $GITHUB_ENV

    - name: ğŸ“¥ Checkout Base Branch
      uses: actions/checkout@v4
      with:
        ref: ${{ github.base_ref }}

    - name: ğŸ—ï¸ Build Base Branch
      run: |
        echo "ğŸ—ï¸ Building base branch..."
        pnpm install --frozen-lockfile
        pnpm build
        BASE_SIZE=$(du -sb dist/ | cut -f1)
        echo "BASE_BUNDLE_SIZE=$BASE_SIZE" >> $GITHUB_ENV

    - name: ğŸ“ˆ Bundle Size Comparison
      run: |
        echo "## ğŸ“ˆ Bundle Size Comparison" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        PR_SIZE_MB=$(echo "scale=2; $PR_BUNDLE_SIZE / 1048576" | bc)
        BASE_SIZE_MB=$(echo "scale=2; $BASE_BUNDLE_SIZE / 1048576" | bc)
        DIFF_BYTES=$(($PR_BUNDLE_SIZE - $BASE_BUNDLE_SIZE))
        DIFF_MB=$(echo "scale=2; $DIFF_BYTES / 1048576" | bc)

        echo "| Branch | Size (MB) |" >> $GITHUB_STEP_SUMMARY
        echo "|--------|-----------|" >> $GITHUB_STEP_SUMMARY
        echo "| Base (${{ github.base_ref }}) | ${BASE_SIZE_MB} MB |" >> $GITHUB_STEP_SUMMARY
        echo "| PR (${{ github.head_ref }}) | ${PR_SIZE_MB} MB |" >> $GITHUB_STEP_SUMMARY
        echo "| **Difference** | **${DIFF_MB} MB** |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        if [ $DIFF_BYTES -gt 0 ]; then
          echo "ğŸ“ˆ Bundle size increased by ${DIFF_MB} MB" >> $GITHUB_STEP_SUMMARY
          if [ $DIFF_BYTES -gt 1048576 ]; then
            echo "::warning::Bundle size increased significantly (+${DIFF_MB} MB)"
          fi
        elif [ $DIFF_BYTES -lt 0 ]; then
          echo "ğŸ“‰ Bundle size decreased by $(echo $DIFF_MB | tr -d '-') MB âœ…" >> $GITHUB_STEP_SUMMARY
        else
          echo "â– No change in bundle size" >> $GITHUB_STEP_SUMMARY
        fi

  # ğŸ·ï¸ VALIDAÃ‡ÃƒO DE COMMITS CONVENCIONAIS
  commit-validation:
    name: ğŸ·ï¸ Commit Validation
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'

    steps:
    - name: ğŸ“¥ Checkout PR
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: ğŸ·ï¸ Validate Conventional Commits
      run: |
        echo "ğŸ·ï¸ Validating commit messages in PR..."

        # Instalar commitlint
        npm install -g @commitlint/cli @commitlint/config-conventional

        echo "## ğŸ·ï¸ Commit Validation Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        # Obter commits do PR
        COMMITS=$(git rev-list --no-merges origin/${{ github.base_ref }}..HEAD)
        TOTAL_COMMITS=$(echo "$COMMITS" | wc -l)
        VALID_COMMITS=0
        INVALID_COMMITS=0

        echo "**Total commits no PR:** $TOTAL_COMMITS" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        for commit in $COMMITS; do
          COMMIT_MSG=$(git log --format=%s -n 1 $commit)
          COMMIT_SHORT=$(echo $commit | cut -c1-7)

          if echo "$COMMIT_MSG" | npx commitlint --config /dev/null --extends @commitlint/config-conventional >/dev/null 2>&1; then
            echo "âœ… \`$COMMIT_SHORT\`: $COMMIT_MSG" >> $GITHUB_STEP_SUMMARY
            VALID_COMMITS=$((VALID_COMMITS + 1))
          else
            echo "âŒ \`$COMMIT_SHORT\`: $COMMIT_MSG" >> $GITHUB_STEP_SUMMARY
            INVALID_COMMITS=$((INVALID_COMMITS + 1))
          fi
        done

        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Resultado:** $VALID_COMMITS vÃ¡lidos, $INVALID_COMMITS invÃ¡lidos" >> $GITHUB_STEP_SUMMARY

        if [ $INVALID_COMMITS -gt 0 ]; then
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ’¡ **Como corrigir:**" >> $GITHUB_STEP_SUMMARY
          echo "- Use \`pnpm commit\` para commits guiados" >> $GITHUB_STEP_SUMMARY
          echo "- Formato: \`tipo(escopo): descriÃ§Ã£o\`" >> $GITHUB_STEP_SUMMARY
          echo "- Tipos vÃ¡lidos: feat, fix, docs, style, refactor, test, chore" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "::warning::Alguns commits nÃ£o seguem o padrÃ£o Conventional Commits"
        else
          echo "âœ… Todos os commits seguem o padrÃ£o Conventional Commits!" >> $GITHUB_STEP_SUMMARY
        fi

  # ğŸ³ BUILD E PUSH VERSIONADO
  build-and-push:
    name: ğŸ³ Build & Push Versioned Image
    runs-on: ubuntu-latest
    needs: quality-check
    if: github.event_name == 'push'
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: ğŸ”§ Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: ğŸ” Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    - name: ğŸ·ï¸ Generate Version Tags
      id: meta
      run: |
        # Gera timestamp para versionamento
        TIMESTAMP=$(date +%Y%m%d-%H%M%S)
        SHORT_SHA=$(echo ${{ github.sha }} | cut -c1-7)
        BRANCH_NAME=$(echo ${{ github.ref_name }} | sed 's/[^a-zA-Z0-9]/-/g')
        
        # Tags baseadas na branch
        BASE_TAG="${{ env.REGISTRY }}/${{ secrets.DOCKER_USERNAME }}/${{ env.IMAGE_NAME }}"
        
        if [[ "${{ github.ref_name }}" == "main" ]]; then
          # Production: v1.0.0, v1.0.0-abc1234, latest
          VERSION="v1.0.${GITHUB_RUN_NUMBER}"
          TAGS="${BASE_TAG}:${VERSION}"
          TAGS="${TAGS},${BASE_TAG}:${VERSION}-${SHORT_SHA}"
          TAGS="${TAGS},${BASE_TAG}:latest"
          TAGS="${TAGS},${BASE_TAG}:stable"
        elif [[ "${{ github.ref_name }}" == "staging" ]]; then
          # Staging: staging-v1.0.0, staging-timestamp
          VERSION="staging-v1.0.${GITHUB_RUN_NUMBER}"
          TAGS="${BASE_TAG}:${VERSION}"
          TAGS="${TAGS},${BASE_TAG}:staging-${TIMESTAMP}"
          TAGS="${TAGS},${BASE_TAG}:staging"
        else
          # Development: develop-timestamp, develop-sha
          TAGS="${BASE_TAG}:develop-${TIMESTAMP}"
          TAGS="${TAGS},${BASE_TAG}:develop-${SHORT_SHA}"
          TAGS="${TAGS},${BASE_TAG}:develop"
        fi
        
        echo "ğŸ·ï¸ Tags geradas: ${TAGS}"
        echo "tags=${TAGS}" >> $GITHUB_OUTPUT
        echo "version=${VERSION:-develop-${TIMESTAMP}}" >> $GITHUB_OUTPUT
        echo "timestamp=${TIMESTAMP}" >> $GITHUB_OUTPUT

    - name: ğŸ³ Build and Push to Docker Hub
      uses: docker/build-push-action@v5
      with:
        context: .
        file: Dockerfile
        platforms: linux/amd64
        push: true
        tags: ${{ steps.meta.outputs.tags }}
        cache-from: type=gha
        cache-to: type=gha,mode=max
        build-args: |
          NODE_ENV=production
          BUILD_TIME=${{ steps.meta.outputs.timestamp }}
        labels: |
          org.opencontainers.image.title=CAC Frontend
          org.opencontainers.image.description=Interface React/TypeScript para o sistema CAC
          org.opencontainers.image.source=${{ github.repositoryUrl }}
          org.opencontainers.image.revision=${{ github.sha }}
          org.opencontainers.image.version=${{ steps.meta.outputs.version }}
          org.opencontainers.image.created=${{ steps.meta.outputs.timestamp }}

    - name: ğŸ“‹ Summary
      run: |
        echo "## ğŸ‰ Build ConcluÃ­do com Sucesso!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“¦ Imagem Gerada:" >> $GITHUB_STEP_SUMMARY
        echo "- **VersÃ£o:** \`${{ steps.meta.outputs.version }}\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Tags:** \`${{ steps.meta.outputs.tags }}\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Branch:** \`${{ github.ref_name }}\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Commit:** \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ³ Como usar:" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
        echo "docker pull ${{ env.REGISTRY }}/${{ secrets.DOCKER_USERNAME }}/${{ env.IMAGE_NAME }}:${{ steps.meta.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸŒ Tecnologias:" >> $GITHUB_STEP_SUMMARY
        echo "- **React 19** + TypeScript 5.8" >> $GITHUB_STEP_SUMMARY
        echo "- **Vite 7** + TailwindCSS 4" >> $GITHUB_STEP_SUMMARY
        echo "- **shadcn/ui** + Radix UI" >> $GITHUB_STEP_SUMMARY
        echo "- **pnpm** + Vitest" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ”— Links:" >> $GITHUB_STEP_SUMMARY
        echo "- [Docker Hub](https://hub.docker.com/r/${{ secrets.DOCKER_USERNAME }}/${{ env.IMAGE_NAME }})" >> $GITHUB_STEP_SUMMARY
        echo "- [RepositÃ³rio](${{ github.repositoryUrl }})" >> $GITHUB_STEP_SUMMARY

  # ğŸ” ANÃLISE DE SEGURANÃ‡A E QUALIDADE
  security-analysis:
    name: ğŸ” Security & Quality Analysis
    runs-on: ubuntu-latest
    needs: quality-check
    if: github.event_name == 'push' && github.ref_name == 'main'
    
    steps:
    - name: ğŸ“¥ Checkout Code
      uses: actions/checkout@v4

    - name: ğŸ“¦ Install pnpm
      uses: pnpm/action-setup@v4
      with:
        run_install: false

    - name: ğŸ”§ Setup Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'pnpm'

    - name: ğŸ“¦ Install Dependencies
      run: pnpm install --frozen-lockfile

    - name: ğŸ” Enhanced Security Audit
      run: |
        echo "ğŸ” Verificando vulnerabilidades nas dependÃªncias..."

        # Executar audit e capturar resultados
        echo "## ğŸ›¡ï¸ Security Audit Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        if pnpm audit --audit-level=high --json > audit-results.json 2>/dev/null; then
          echo "âœ… Nenhuma vulnerabilidade crÃ­tica encontrada" >> $GITHUB_STEP_SUMMARY
        else
          echo "âš ï¸ Vulnerabilidades encontradas:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Contar vulnerabilidades por severidade
          if [ -f audit-results.json ]; then
            HIGH=$(jq -r '.metadata.vulnerabilities.high // 0' audit-results.json 2>/dev/null || echo "0")
            MODERATE=$(jq -r '.metadata.vulnerabilities.moderate // 0' audit-results.json 2>/dev/null || echo "0")
            LOW=$(jq -r '.metadata.vulnerabilities.low // 0' audit-results.json 2>/dev/null || echo "0")

            echo "| Severidade | Quantidade |" >> $GITHUB_STEP_SUMMARY
            echo "|------------|------------|" >> $GITHUB_STEP_SUMMARY
            echo "| High | $HIGH |" >> $GITHUB_STEP_SUMMARY
            echo "| Moderate | $MODERATE |" >> $GITHUB_STEP_SUMMARY
            echo "| Low | $LOW |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY

            if [ "$HIGH" -gt 0 ]; then
              echo "::warning::Vulnerabilidades crÃ­ticas encontradas: $HIGH"
            fi
          fi

          echo "ğŸ’¡ Execute \`pnpm audit fix\` para corrigir automaticamente ou \`pnpm audit\` para detalhes" >> $GITHUB_STEP_SUMMARY
        fi

    - name: ğŸ”’ Dependency Review (PRs)
      if: github.event_name == 'pull_request'
      uses: actions/dependency-review-action@v4
      with:
        fail-on-severity: high
        allow-licenses: MIT, Apache-2.0, BSD-2-Clause, BSD-3-Clause, ISC

    - name: ğŸ“Š Bundle Size Analysis
      run: |
        echo "ğŸ“Š Analisando tamanho do bundle..."
        pnpm build
        echo "ğŸ“ Arquivos gerados:"
        ls -la dist/assets/ || echo "DiretÃ³rio dist nÃ£o encontrado"